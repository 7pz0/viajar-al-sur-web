<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ver datos - Viajar al Sur</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    
    .usuario-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .usuario-card img {
      border-radius: 5px;
      margin-top: 10px;
    }
    
    .loading {
      text-align: center;
      color: #666;
      font-style: italic;
    }
    
    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      padding: 15px;
      border-radius: 5px;
    }
    
    .no-data {
      text-align: center;
      color: #666;
      font-style: italic;
      padding: 20px;
    }
    
    h2 {
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
  </style>
</head>
<body>
  <h2>Usuarios registrados - Viajar al Sur</h2>

  <!-- Contenedor donde se mostrarán los usuarios -->
  <div id="usuarios">
    <div class="loading">Cargando usuarios...</div>
  </div>

  <!-- Firebase v9 SDKs con sintaxis modular -->
  <script type="module">
    // Importar las funciones necesarias de Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js';
    import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js';

    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAn4aEuwIBv21bQK3qfKaUhszVuFeEmJvw",
      authDomain: "viajaralsur.firebaseapp.com",
      projectId: "viajaralsur",
      storageBucket: "viajaralsur.firebasestorage.app",
      messagingSenderId: "927613299224",
      appId: "1:927613299224:web:9ef767c182b20569dff16d",
      measurementId: "G-3CQSZQ04DJ"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const container = document.getElementById("usuarios");

    // Función para formatear fecha
    function formatearFecha(timestamp) {
      if (!timestamp) return "Fecha no disponible";
      
      // Si es un Timestamp de Firebase
      if (timestamp.toDate) {
        return timestamp.toDate().toLocaleString('es-ES');
      }
      
      // Si es un objeto Date
      if (timestamp instanceof Date) {
        return timestamp.toLocaleString('es-ES');
      }
      
      return "Fecha no válida";
    }

    // Leer todos los documentos de la colección "usuarios"
    async function cargarUsuarios() {
      try {
        const q = query(collection(db, "usuarios"), orderBy("fecha", "desc"));
        const querySnapshot = await getDocs(q);
        
        container.innerHTML = ""; // Limpiar contenido

        if (querySnapshot.empty) {
          container.innerHTML = '<div class="no-data">No hay usuarios registrados.</div>';
        } else {
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const div = document.createElement("div");
            div.className = "usuario-card";

            div.innerHTML = `
              <p><strong>Nombre:</strong> ${data.nombre || 'No especificado'}</p>
              <p><strong>Email:</strong> ${data.correo || 'No especificado'}</p>
              <p><strong>Fecha:</strong> ${formatearFecha(data.fecha)}</p>
              <p><strong>ID:</strong> ${doc.id}</p>
              ${data.imagen ? 
                `<div><strong>Imagen:</strong><br><img src="${data.imagen}" alt="Imagen de ${data.nombre}" style="max-width:150px;"></div>` : 
                '<p><em>Sin imagen</em></p>'
              }
            `;
            container.appendChild(div);
          });
        }
      } catch (error) {
        console.error("Error al cargar usuarios:", error);
        container.innerHTML = `<div class="error">❌ Error al leer datos: ${error.message}</div>`;
      }
    }

    // Cargar usuarios al iniciar la página
    cargarUsuarios();
  </script>
</body>
</html>